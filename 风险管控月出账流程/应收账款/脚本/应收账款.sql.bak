
------------------------------------------------begin------------------------------------------------
---总流程：
         
  --  1、更新手工数据的area_code ->经分基础欠费(RULE_ID:300030049)
  --  ->风险管控 库内欠费数据（pu_busi_ind.p_bm_Accounts_recv_m10 日参数 每月7日跑 ETL(库内欠费及用户数分析)
  --  ->省政企、商客欠费账龄(经分 pu_busi_ind.p_bm_own_fee_age_m)
        
  --  2、alter table PU_INTF.INTF_DATA_M2 add partition p201707 values('201707'); （分区添加 -->执行存过PU_INTF.p_INTF_DATA_M2） 11号左右取数 经分
  --  ->风险管控应收账款流程(ETL--应收账款调度流)-->经分前台导出
--------------------------------------------------end-------------------------------------------------


------------------------------------经分一键导出配置表------------------------------------------
          -----配置表有相应的出数脚本----
  select t.*, rowid
  from META_SYS_MG.META_TAB_LEVL t
    where  TASK_NAME LIKE '%经营收入%'
  order by TASK_ID, SHEET_ID;
 
 select t.*, rowid
  from META_SYS_MG.META_TAB_LEVL t
    where  TASK_NAME LIKE '%主营收入%'
  order by TASK_ID, SHEET_ID;
 
 
 
------------------------------ 更新手工数据的area_code--------------------------------------------
-----更新地市编码
--党政军有两张表PU_INTF.F_OWE_MONTH_DZJ_M  201705之后表结构有变 后续用该表201705之前数据的时候用PU_INTF.F_OWE_MONTH_DZJ_M表

----------- select * from PU_INTF.F_OWE_MONTH_DZJ_M2 a where a.month_no='201711' ;
update PU_INTF.F_OWE_MONTH_DZJ_M2 a
   set area_code =
         (select local_code
            from pu_meta.d_cw_area_info2 b
           where trim(decode(a.area_name,
                        '号百',
                        '号百（创新部）',
                        '合计',
                        '全省',
                        a.area_name)) = trim(b.area_name)) 
    where a.month_no='201711' ;
    commit;

update PU_INTF.F_OWE_MONTH_DZJ_M2 
set area_name=trim(replace(replace(area_name,chr(13),''), chr(10),''))
where month_no='201711';
commit; 

----------------- select * from  pu_intf.f_business_balance_m  a where a.month_no='201711';
update pu_intf.f_business_balance_m  a
   set area_code =
         (select local_code
            from pu_meta.d_cw_area_info2 b
           where trim(decode(a.area_name,
                        '号百',
                        '号百（创新部）',
                        '全省（汇总）',
                        '全省', 
                        a.area_name)) = trim(b.area_name))
    where a.month_no='201711';
    commit;
    
--修改中文地市中的回车符、换行符
update PU_INTF.F_BUSINESS_BALANCE_M 
set area_name=trim(replace(replace(area_name,chr(13),''), chr(10),''))
where month_no='201711';
commit;




--依赖数据：
接口数据
经营分析模板（经分）
欠费基础数据（经分）300030049
pu_busi_ind.p_bm_Accounts_recv_m10(出表pu_base_ind.DM_OWE_KN_NEW03) 库内欠费数据 日参数 --fxgk
省政企、商客欠费账龄(经分) 600010040
省政企、商客欠费账龄(风险管控) pu_busi_ind.p_bm_own_fee_age_m  pu_busi_ind.bm_own_fee_age_m2 重跑历史数据的时候需要先重跑经分的欠费基础数据

pu_busi_ind.p_bm_Accounts_recv_m1 其中有收入数据生成沉淀表 故是后面1到10存过的依赖基础 select * from PU_INTF.INTF_DATA_M2@DL_EDW_YN where month_no=201711 and ID_ZBCODE='CWYSMX1200_03';
pu_busi_ind.p_bm_Accounts_recv_m2 
pu_busi_ind.p_bm_Accounts_recv_m3  
pu_busi_ind.p_bm_Accounts_recv_m4 必须依赖存过3
pu_busi_ind.p_bm_Accounts_recv_m5 
pu_busi_ind.p_bm_Accounts_recv_m6 
pu_busi_ind.p_bm_Accounts_recv_m7 
pu_busi_Ind.p_bm_Accounts_recv_m8 

------------------  
  declare
  v_date varchar2(6);
  begin
  v_date :='201705'; -- 上月账期
  --Call the procedure
  pu_busi_ind.p_bm_Accounts_recv_m1(v_date);
  pu_busi_ind.p_bm_Accounts_recv_m2(v_date);
  pu_busi_ind.p_bm_Accounts_recv_m3(v_date);
  pu_busi_ind.p_bm_Accounts_recv_m4(v_date);
  pu_busi_ind.p_bm_Accounts_recv_m5(v_date);
  pu_busi_ind.p_bm_Accounts_recv_m6(v_date); 
  pu_busi_ind.p_bm_Accounts_recv_m7(v_date); 
  pu_busi_ind.p_bm_Accounts_recv_m8(v_date);  
  end;
  